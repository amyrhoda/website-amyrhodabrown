<!doctype html> 
<html>
<head>
  <!--#include virtual="/include/head.html" -->
</head>

<body>
  <!--#include virtual="/include/nav.html" -->
  <!--#include virtual="/include/banner.html" -->

  <section class="content box">
    <h2 id="top">LaTeX to Lulu: The Making of AOSA</h2>
    <h3 class="l2l">Custom Commands and Environments</h3>
    <p class="pubdate">Originally posted: June 1, 2012</p>



<span style="color:#666699;">The two volumes of <a href="http://www.aosabook.org"><span style="color:#666699;"><em>The Architecture of Open Source Applications</em></span></a> were typeset with LaTeX and printed through <a href="http://www.lulu.com/"><span style="color:#666699;">Lulu</span></a>. I couldn't have finished the <em>AOSA</em> books without the generosity of people all over the world who posted their LaTeX tips to forums and blogs. This series of posts pays some of that back by sharing what I learned.</span>

<span style="color:#666699;">This is the fourth post in the series.</span>
<h4><span style="color:#666699;">LaTeX to Lulu</span></h4>
<ol>
	<li><span style="color:#666699;"><a href="http://amyrhoda.wordpress.com/2012/05/25/latex-to-lulu-the-making-of-aosa-geometry-and-headers-and-footers/"><span style="color:#666699;">Headers and Footers</span></a></span></li>
	<li><span style="color:#666699;"><a title="LaTeX to Lulu, the Making of AOSA: Fonts and Captions" href="http://amyrhoda.wordpress.com/2012/05/28/latex-to-lulu-the-making-of-aosa-fonts-and-captions/"><span style="color:#666699;">Fonts and Captions</span></a></span></li>
	<li><span style="color:#666699;"><a title="LaTeX to Lulu, The Making of AOSA: Table of Contents and Chapter Titles" href="http://amyrhoda.wordpress.com/2012/05/30/latex-to-lulu-the-making-of-aosa-table-of-contents-and-chapter-titles/"><span style="color:#666699;">Table of Contents and Chapter Title Pages</span></a></span></li>
	<li><span style="color:#666699;"><strong>Custom Commands and Environments</strong></span></li>
	<li><a title="LaTeX to Lulu, the Making of AOSA: Other Useful Packages and Settings" href="http://amyrhoda.wordpress.com/2012/06/04/latex-to-lulu-the-making-of-aosa-other-useful-packages-and-settings/"><span style="color:#666699;">Other Useful Packages and Settings</span></a></li>
	<li><a title="LaTeX to Lulu, the Making of AOSA: Pulling It All Together" href="http://amyrhoda.wordpress.com/2012/06/07/latex-to-lulu-the-making-of-aosa-pulling-it-all-together/"><span style="color:#666699;">Pulling It All Together</span></a></li>
</ol>
Today's post is about the custom LaTeX commands and environments we created for the AOSA books.

<!--more-->As I said in an <a title="LaTeX to Lulu, The Making of AOSA: Table of Contents and Chapter Titles" href="http://amyrhoda.wordpress.com/2012/05/30/latex-to-lulu-the-making-of-aosa-table-of-contents-and-chapter-titles/">earlier post</a>, we had to set up some new commands and environments to deal with the fact that each chapter of the AOSA book has a different author or team of authors. LaTeX has an <code>author</code> setting; we created <code>chapterauthor</code>.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newcommand{\chapterauthor}{}</pre>
Our <code>aosachapter</code> environment takes the name of the chapter, the label (a unique string which identifies the chapter) and the author(s). It sets all the respective LaTeX settings with the appropriate values, and then populates the table of contents.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newenvironment{aosachapter}[3]
{ \renewcommand{\chapterauthor}{#3} \chapter{#1} \label{#2}
   \addtocontents{toc}{\hspace{1cm}\textit{\textsf{by \chapterauthor}}\protect\par} } {  }</pre>
We created some environments which were basically just new names for existing LaTeX environments. That was Greg's doing, and at first it seemed pretty pointless to me. But later, when I wanted to change the design of an environment, it was really handy to have our own custom environment defined so I could futz with it.

(Having said that, clearly I didn't futz with the following three environments.)
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newenvironment{aosasect1}[1]{\section{#1}}{}
\newenvironment{aosasect2}[1]{\subsection{#1}}{}
\newenvironment{aosasect3}[1]{\subsubsection*{#1}}{}</pre>
There is no sidebar environment in LaTeX, so I created a sidebar called <code>aosabox</code> using <code>figure</code>, <code>minipage</code> and the <code>framed</code> package. <code>figure</code> tells LaTeX that the sidebar is an entity that isn't part of the text and that doesn't break over a page. <code>framed</code> lets you put a box around the <code>minipage</code>. I also added a rule at the top and the bottom of the box to create a double line for texture.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newenvironment{aosabox}[1]
{ \begin{figure}[h!]\vspace{-0.7cm}\centering \rule[-.7cm]{13.83cm}{0.75pt} 
  \begin{minipage}[t]{13.83cm}\begin{framed}\centerline{{\textbf{#1}}} }
{ \end{framed}\end{minipage} \rule{13.83cm}{0.75pt} \end{figure} }</pre>
Here's how the sidebar looks (this is one of the lessons from the <a title="BDB chapter" href="http://www.aosabook.org/en/bdb.html">BDB chapter</a> in Volume I):
<p style="text-align:center;"><a href="http://amyrhoda.files.wordpress.com/2012/06/sidebar.jpg"><img class="aligncenter size-full wp-image-162" style="border:0 none;" title="Sidebar Example" src="http://amyrhoda.files.wordpress.com/2012/06/sidebar.jpg" alt="Example of sidebar" width="581" height="193" /></a></p>
We created custom environments to replace LaTeX's three list types: <code>aosadescription</code>, <code>aosaenumerate</code>, and <code>aosaitemize</code>. This is where I did the futzing: I didn't like the spacing in the default lists, so I spent a lot of time fiddling with these settings.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newenvironment{aosadescription}
{\begin{description}[itemsep=-0.1ex,parsep=0.3ex,topsep=0.2ex,leftmargin=10mm]}
{\end{description}}

\newenvironment{aosaenumerate}
{\begin{enumerate}[itemsep=-0.8ex,topsep=0.2ex,leftmargin=10mm]}
{\end{enumerate}}

\newenvironment{aosaitemize}
{\begin{itemize}[itemsep=-0.8ex,topsep=0.2ex,leftmargin=8.5mm]}
{\end{itemize}}</pre>
Some chapters had lists nested within lists, and the spacing I'd set up for the outer lists didn't work for the nested lists, so I created new environments for them.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">% new environment for second-level nested enumerated lists
\newenvironment{aosaenumerate2}
{\begin{enumerate}[itemsep=-0.7ex,topsep=-1ex,leftmargin=10mm]}
{\end{enumerate}}

% new environment for second-level nested itemized lists
\newenvironment{aosaitemize2}
{\begin{itemize}[itemsep=-0.5ex,topsep=-1ex,leftmargin=9mm]}
{\end{itemize}}</pre>
We set up new commands for references. LaTeX's default references just give you the number of the object you're referencing (like "12.1" for the first section in the 12th chapter). Our commands are specific to the object you're referencing — <code>aosafigref</code> for figures and <code>aosasecref</code> for sections — and they return "Figure " or "Section " as well as the number.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newcommand{\aosaboxref}[1]{Box~\ref{#1}}
\newcommand{\aosachapref}[1]{Chapter~\ref{#1}}
\newcommand{\aosafigref}[1]{Figure~\ref{#1}}
\newcommand{\aosasecref}[1]{Section~\ref{#1}}
\newcommand{\aosatblref}[1]{Table~\ref{#1}}</pre>
We created a new command for images. Again, it uses LaTeX's default <code>figure</code> and <code>includegraphics</code> settings but accepts and passes on our parameters so we can enforce consistent image layout throughout the book.

<code>aosafigure</code> accepts the image width, the filename of the image, the caption, and a unique label for the figure. It passes the width and filename to <code>includegraphics</code>, the caption to <code>caption</code> and the label to <code>label</code>. Width is an optional parameter, and if it's not passed in we set the default to be 375 points. (LaTeX automatically scales the image and keeps the aspect ratio, so you only have to pass in width.)
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newcommand{\aosafigure}[4][375pt]{\begin{figure}[h!]\centering\includegraphics
[width={#1}]{#2}\caption{#3}\label{#4}\end{figure}}</pre>
In the <code>aosafigure</code> command we called <code>figure</code> with the <code>h!</code> option, which stands for "here" and means we want the figure to be placed as close to where it is defined in the source as possible. (The exclamation mark means we really mean it.) But sometimes I wanted the figure to be placed at the top of the nearest page, say if it is a large image and would look awkward with just a few lines of text above it. So I created an <code>aosafigureTop</code> command for those cases.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newcommand{\aosafigureTop}[4][375pt]{\begin{figure}[t]\centering\includegraphics
[width={#1}]{#2}\caption{#3}\label{#4}\end{figure}}</pre>
We created a new command called <code>code</code> for code, instead of LaTeX's <code>texttt</code>.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newcommand{\code}[1]{\texttt{#1}}</pre>
I also created a "small code" command for one table in one chapter which needed a smaller text size.
<pre style="border:solid 1px;padding:10px;background:#eeeeee;">\newcommand{\smcode}[1]{\small\texttt{#1}\normalsize}</pre>
That's all our custom commands and environments. Next time: a compendium of the miscellaneous packages and settings which didn't fit into the first four posts of this series.




    <p class="article-nav">
    Previous article: <a href="160512-latex-fonts-and-captions.html">...</a>
    <a href="#top">Top</a> | 
    Next article: <a href="160512-latex-fonts-and-captions.html">Fonts and 
      Captions</a>.
   </p>
  </section>

  <!--#include virtual="../include/footer.html" -->

</body>
</html>
